<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ“ä½œç³»ç»Ÿ - å¸çƒŸè€…é—®é¢˜ä¸‰ç§æ–¹æ¡ˆæ¨¡æ‹Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                        dark: '#1E293B',
                        light: '#F8FAFC',
                        petri: '#8B5CF6' // Petriç½‘æ–¹æ¡ˆä¸»é¢˜è‰²
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto { content-visibility: auto; }
            .card-shadow { box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); }
            .card-hover { transition: transform 0.3s ease, box-shadow 0.3s ease; }
            .card-hover:hover { transform: translateY(-5px); box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12); }
            .pulse-animation { animation: pulse 2s infinite; }
            @keyframes pulse {
                0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
                70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
                100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
            }
            .fade-in { animation: fadeIn 0.5s ease-in; }
            @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
            .slide-up { animation: slideUp 0.3s ease-out; }
            @keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
            .resource-item {
                position: fixed; /* æ”¹ä¸ºfixedå®šä½è§£å†³æ»šåŠ¨é—®é¢˜ */
                transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
                z-index: 10;
                pointer-events: none;
                opacity: 0;
            }
            .resource-to-table { opacity: 1; }
            .resource-to-smoker { opacity: 1; }
            .resource-disappear {
                opacity: 0;
                transform: scale(0.5);
                transition: all 0.3s ease-out;
            }
            .resource-grid-cell { transition: all 0.3s ease; }
            .resource-grid-cell.filled { background-color: rgba(59, 130, 246, 0.1); border-color: #3B82F6; }
            .resource-grid-cell.petri-filled { background-color: rgba(139, 92, 246, 0.1); border-color: #8B5CF6; }
            .tab-active { border-bottom: 3px solid #3B82F6; color: #3B82F6; font-weight: 600; }
            .tab-petri-active { border-bottom: 3px solid #8B5CF6; color: #8B5CF6; font-weight: 600; }
            .tab-deadlock-active { border-bottom: 3px solid #EF4444; color: #EF4444; font-weight: 600; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen py-6 px-4 md:px-6 relative">
    <!-- èµ„æºåŠ¨ç”»å®¹å™¨ -->
    <div id="resource-animation-container" class="fixed inset-0 pointer-events-none z-20"></div>

    <div class="container mx-auto max-w-7xl bg-white rounded-xl shadow-lg overflow-hidden relative z-10">
        <!-- æ ‡é¢˜åŒºåŸŸ -->
        <div class="bg-gradient-to-r from-primary to-blue-700 text-white p-6 md:p-8">
            <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-center mb-2">å¸çƒŸè€…é—®é¢˜ä¸‰ç§æ–¹æ¡ˆæ¨¡æ‹Ÿ</h1>
            <h2 class="text-center text-blue-100 font-normal text-[clamp(1rem,1.5vw,1.25rem)]">
                ä¼ ç»Ÿä¿¡å·é‡ï¼ˆæœ‰æ­»é”ï¼‰| Parnasè¾…åŠ©è¿›ç¨‹ï¼ˆæ— æ­»é”ï¼‰| Petriç½‘æŠ‘åˆ¶å¼§ï¼ˆæ— æ­»é”ï¼‰
            </h2>
        </div>

        <!-- æ–¹æ¡ˆåˆ‡æ¢é€‰é¡¹å¡ -->
        <div class="border-b border-gray-200 bg-white">
            <div class="flex flex-wrap">
                <button id="tab-deadlock" class="px-6 py-4 text-gray-600 hover:text-danger transition-colors duration-300">
                    1. ä¼ ç»Ÿä¿¡å·é‡æ–¹æ¡ˆï¼ˆæœ‰æ­»é”ï¼‰
                </button>
                <button id="tab-parnas" class="px-6 py-4 text-gray-600 hover:text-primary transition-colors duration-300 tab-active">
                    2. Parnasè¾…åŠ©è¿›ç¨‹æ–¹æ¡ˆï¼ˆæ— æ­»é”ï¼‰
                </button>
                <button id="tab-petri" class="px-6 py-4 text-gray-600 hover:text-petri transition-colors duration-300">
                    3. Petriç½‘æŠ‘åˆ¶å¼§æ–¹æ¡ˆï¼ˆæ— æ­»é”ï¼‰
                </button>
            </div>
        </div>

        <!-- æ–¹æ¡ˆ1ï¼šä¼ ç»Ÿä¿¡å·é‡æ–¹æ¡ˆï¼ˆæœ‰æ­»é”ï¼‰ -->
        <div id="scheme-deadlock" class="hidden">
            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="bg-gray-50 border-b border-gray-100 p-4 md:p-6">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="flex items-center space-x-3">
                        <button id="dl-startBtn" class="bg-secondary hover:bg-green-600 text-white font-medium py-2 px-6 rounded-lg transition-all duration-300 flex items-center">
                            <i class="fa fa-play mr-2"></i> å¼€å§‹æ¨¡æ‹Ÿ
                        </button>
                        <button id="dl-pauseBtn" class="bg-warning hover:bg-amber-600 text-white font-medium py-2 px-6 rounded-lg transition-all duration-300 flex items-center opacity-50 cursor-not-allowed" disabled>
                            <i class="fa fa-pause mr-2"></i> æš‚åœæ¨¡æ‹Ÿ
                        </button>
                        <button id="dl-resetBtn" class="bg-danger hover:bg-red-600 text-white font-medium py-2 px-6 rounded-lg transition-all duration-300 flex items-center">
                            <i class="fa fa-refresh mr-2"></i> é‡ç½®æ¨¡æ‹Ÿ
                        </button>
                    </div>
                    <div class="flex items-center gap-3 w-full md:w-auto">
                        <label for="dl-speedControl" class="text-gray-700 font-medium whitespace-nowrap">æ¨¡æ‹Ÿé€Ÿåº¦:</label>
                        <input type="range" id="dl-speedControl" min="1" max="10" value="5" class="w-full md:w-40 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-danger">
                        <span id="dl-speedValue" class="text-gray-700 font-medium min-w-[3rem] text-center">ä¸­ç­‰</span>
                    </div>
                </div>
                <!-- æ–¹æ¡ˆæç¤º -->
                <div class="mt-4 p-3 bg-red-50 border border-red-100 rounded-lg text-sm text-danger">
                    <i class="fa fa-exclamation-triangle mr-1"></i> 
                    <strong>æ–¹æ¡ˆç‰¹æ€§</strong>ï¼šç›´æ¥ä½¿ç”¨P/Vä¿¡å·é‡ï¼Œæ— æ³•åŸå­æ€§æ£€æµ‹ä¸¤ç§èµ„æºï¼Œæ˜“è§¦å‘æ­»é”ï¼ˆå¦‚ï¼šå¸çƒŸè€…AæŠ¢çº¸ã€å¸çƒŸè€…BæŠ¢ç«æŸ´åäº’ç›¸ç­‰å¾…ï¼‰
                </div>
            </div>

            <!-- æ¨¡æ‹ŸåŒºåŸŸ -->
            <div class="p-4 md:p-6">
                <div class="grid grid-cols-1 lg:grid-cols-5 gap-4 md:gap-6 relative">
                    <!-- ä»£ç† -->
                    <div class="lg:col-span-1 bg-white rounded-xl p-4 card-shadow card-hover" id="dl-agent-area">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-bold text-dark flex items-center">
                                <i class="fa fa-cogs text-danger mr-2"></i> ä»£ç† (Agent)
                            </h3>
                            <span id="dl-agentStatusBadge" class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">
                                å°±ç»ª
                            </span>
                        </div>
                        <div id="dl-agentState" class="p-3 bg-gray-50 rounded-lg text-gray-700 mb-3 text-center">
                            ç­‰å¾…å¼€å§‹
                        </div>
                        <div class="text-sm text-gray-600 mb-2">
                            <i class="fa fa-signal text-danger mr-1"></i> ä¿¡å·é‡çŠ¶æ€ï¼š
                        </div>
                        <div class="text-xs text-gray-500 space-y-1">
                            <div>paper_sem: <span id="dl-paper-sem">0</span></div>
                            <div>match_sem: <span id="dl-match-sem">0</span></div>
                            <div>tobacco_sem: <span id="dl-tobacco-sem">0</span></div>
                            <div>agent_sem: <span id="dl-agent-sem">1</span></div>
                        </div>
                    </div>

                    <!-- æ¡Œé¢ï¼ˆå…±äº«èµ„æºåŒºï¼‰ -->
                    <div class="lg:col-span-3 bg-gradient-to-br from-red-50 to-orange-50 rounded-xl p-5 card-shadow flex flex-col" id="dl-table-area">
                        <h3 class="text-lg font-bold text-dark mb-4 flex items-center">
                            <i class="fa fa-table text-danger mr-2"></i> å…±äº«æ¡Œé¢ï¼ˆèµ„æºæ ¼å­ï¼‰
                        </h3>
                        <div class="flex-grow flex flex-col items-center justify-center">
                            <div class="w-full max-w-md h-48 bg-white rounded-lg card-shadow p-4 mb-4">
                                <div class="grid grid-cols-3 gap-4 h-full">
                                    <!-- çƒŸè‰æ ¼å­ -->
                                    <div id="dl-tobacco-cell" class="resource-grid-cell border-2 border-gray-200 rounded-lg flex flex-col items-center justify-center">
                                        <span class="text-green-600 text-2xl mb-1">ğŸŒ¿</span>
                                        <span class="text-xs text-gray-500">çƒŸè‰</span>
                                        <div id="dl-tobacco-content" class="mt-2 opacity-0 transition-opacity duration-300">
                                            <span class="text-green-600 text-3xl">ğŸŒ¿</span>
                                        </div>
                                    </div>
                                    <!-- çº¸æ ¼å­ -->
                                    <div id="dl-paper-cell" class="resource-grid-cell border-2 border-gray-200 rounded-lg flex flex-col items-center justify-center">
                                        <span class="text-gray-600 text-2xl mb-1">ğŸ“„</span>
                                        <span class="text-xs text-gray-500">çº¸</span>
                                        <div id="dl-paper-content" class="mt-2 opacity-0 transition-opacity duration-300">
                                            <span class="text-gray-600 text-3xl">ğŸ“„</span>
                                        </div>
                                    </div>
                                    <!-- ç«æŸ´æ ¼å­ -->
                                    <div id="dl-match-cell" class="resource-grid-cell border-2 border-gray-200 rounded-lg flex flex-col items-center justify-center">
                                        <span class="text-orange-500 text-2xl mb-1">ğŸ”¥</span>
                                        <span class="text-xs text-gray-500">ç«æŸ´</span>
                                        <div id="dl-match-content" class="mt-2 opacity-0 transition-opacity duration-300">
                                            <span class="text-orange-500 text-3xl">ğŸ”¥</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- æ­»é”æç¤ºï¼ˆåˆå§‹éšè—ï¼‰ -->
                            <div id="dl-deadlock-alert" class="hidden p-3 bg-red-100 border border-red-200 rounded-lg text-danger text-center font-medium">
                                <i class="fa fa-lock mr-1"></i> æ£€æµ‹åˆ°æ­»é”ï¼è¯·é‡ç½®æ¨¡æ‹Ÿ
                            </div>
                        </div>
                        <!-- ç»Ÿè®¡é¢æ¿ -->
                        <div class="mt-6 grid grid-cols-3 gap-3">
                            <div class="bg-white p-3 rounded-lg card-shadow">
                                <p class="text-xs text-gray-500 mb-1">å¸çƒŸè€…A</p>
                                <div class="flex items-center">
                                    <span id="dl-smokerACount" class="text-xl font-bold text-secondary">0</span>
                                    <span class="text-sm text-gray-500 ml-1">æ¬¡å¸çƒŸ</span>
                                </div>
                            </div>
                            <div class="bg-white p-3 rounded-lg card-shadow">
                                <p class="text-xs text-gray-500 mb-1">å¸çƒŸè€…B</p>
                                <div class="flex items-center">
                                    <span id="dl-smokerBCount" class="text-xl font-bold text-secondary">0</span>
                                    <span class="text-sm text-gray-500 ml-1">æ¬¡å¸çƒŸ</span>
                                </div>
                            </div>
                            <div class="bg-white p-3 rounded-lg card-shadow">
                                <p class="text-xs text-gray-500 mb-1">å¸çƒŸè€…C</p>
                                <div class="flex items-center">
                                    <span id="dl-smokerCCount" class="text-xl font-bold text-secondary">0</span>
                                    <span class="text-sm text-gray-500 ml-1">æ¬¡å¸çƒŸ</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å¸çƒŸè€…åŒºåŸŸ -->
                    <div class="lg:col-span-1 flex flex-col gap-4">
                        <!-- å¸çƒŸè€…Aï¼ˆæŒçƒŸè‰ï¼‰ -->
                        <div class="bg-white rounded-xl p-4 card-shadow card-hover" id="dl-smokerA-area">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-lg font-bold text-dark">å¸çƒŸè€…A</h3>
                                <span id="dl-smokerAStatusBadge" class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">
                                    ç­‰å¾…
                                </span>
                            </div>
                            <p class="text-sm text-gray-600 mb-1">
                                <i class="fa fa-leaf text-green-600 mr-1"></i> æŒæœ‰ï¼šçƒŸè‰
                            </p>
                            <p class="text-sm text-gray-600 mb-3">
                                <i class="fa fa-arrow-right text-danger mr-1"></i> éœ€è·å–ï¼šçº¸ + ç«æŸ´
                            </p>
                            <div id="dl-smokerAState" class="p-2 bg-gray-50 rounded-lg text-gray-700 text-center text-sm">
                                ç­‰å¾…èµ„æº
                            </div>
                        </div>
                        <!-- å¸çƒŸè€…Bï¼ˆæŒçº¸ï¼‰ -->
                        <div class="bg-white rounded-xl p-4 card-shadow card-hover" id="dl-smokerB-area">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-lg font-bold text-dark">å¸çƒŸè€…B</h3>
                                <span id="dl-smokerBStatusBadge" class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">
                                    ç­‰å¾…
                                </span>
                            </div>
                            <p class="text-sm text-gray-600 mb-1">
                                <i class="fa fa-file-text-o text-gray-600 mr-1"></i> æŒæœ‰ï¼šçº¸
                            </p>
                            <p class="text-sm text-gray-600 mb-3">
                                <i class="fa fa-arrow-right text-danger mr-1"></i> éœ€è·å–ï¼šçƒŸè‰ + ç«æŸ´
                            </p>
                            <div id="dl-smokerBState" class="p-2 bg-gray-50 rounded-lg text-gray-700 text-center text-sm">
                                ç­‰å¾…èµ„æº
                            </div>
                        </div>
                        <!-- å¸çƒŸè€…Cï¼ˆæŒç«æŸ´ï¼‰ -->
                        <div class="bg-white rounded-xl p-4 card-shadow card-hover" id="dl-smokerC-area">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-lg font-bold text-dark">å¸çƒŸè€…C</h3>
                                <span id="dl-smokerCStatusBadge" class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">
                                    ç­‰å¾…
                                </span>
                            </div>
                            <p class="text-sm text-gray-600 mb-1">
                                <i class="fa fa-fire text-orange-500 mr-1"></i> æŒæœ‰ï¼šç«æŸ´
                            </p>
                            <p class="text-sm text-gray-600 mb-3">
                                <i class="fa fa-arrow-right text-danger mr-1"></i> éœ€è·å–ï¼šçƒŸè‰ + çº¸
                            </p>
                            <div id="dl-smokerCState" class="p-2 bg-gray-50 rounded-lg text-gray-700 text-center text-sm">
                                ç­‰å¾…èµ„æº
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ—¥å¿—åŒºåŸŸ -->
            <div class="p-4 md:p-6 border-t border-gray-100 bg-gray-50">
                <h3 class="text-lg font-bold text-dark mb-4 flex items-center">
                    <i class="fa fa-history text-danger mr-2"></i> æ¨¡æ‹Ÿæ—¥å¿—ï¼ˆä¼ ç»Ÿä¿¡å·é‡æ–¹æ¡ˆï¼‰
                </h3>
                <div id="dl-log-area" class="h-64 bg-white rounded-xl p-4 overflow-y-auto card-shadow">
                    <div class="log-item log-system fade-in">
                        <span class="log-time text-gray-400">[ç³»ç»Ÿåˆå§‹åŒ–]</span>
                        <span>ä¼ ç»Ÿä¿¡å·é‡æ–¹æ¡ˆå°±ç»ªï¼Œç‚¹å‡»ã€Œå¼€å§‹æ¨¡æ‹Ÿã€å¯åŠ¨ï¼ˆæ˜“è§¦å‘æ­»é”ï¼‰</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ–¹æ¡ˆ2ï¼šParnasè¾…åŠ©è¿›ç¨‹æ–¹æ¡ˆï¼ˆæ— æ­»é”ï¼‰ -->
        <div id="scheme-parnas" class="block">
            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="bg-gray-50 border-b border-gray-100 p-4 md:p-6">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="flex items-center space-x-3">
                        <button id="pn-startBtn" class="bg-secondary hover:bg-green-600 text-white font-medium py-2 px-6 rounded-lg transition-all duration-300 flex items-center">
                            <i class="fa fa-play mr-2"></i> å¼€å§‹æ¨¡æ‹Ÿ
                        </button>
                        <button id="pn-pauseBtn" class="bg-warning hover:bg-amber-600 text-white font-medium py-2 px-6 rounded-lg transition-all duration-300 flex items-center opacity-50 cursor-not-allowed" disabled>
                            <i class="fa fa-pause mr-2"></i> æš‚åœæ¨¡æ‹Ÿ
                        </button>
                        <button id="pn-resetBtn" class="bg-danger hover:bg-red-600 text-white font-medium py-2 px-6 rounded-lg transition-all duration-300 flex items-center">
                            <i class="fa fa-refresh mr-2"></i> é‡ç½®æ¨¡æ‹Ÿ
                        </button>
                    </div>
                    <div class="flex items-center gap-3 w-full md:w-auto">
                        <label for="pn-speedControl" class="text-gray-700 font-medium whitespace-nowrap">æ¨¡æ‹Ÿé€Ÿåº¦:</label>
                        <input type="range" id="pn-speedControl" min="1" max="10" value="5" class="w-full md:w-40 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary">
                        <span id="pn-speedValue" class="text-gray-700 font-medium min-w-[3rem] text-center">ä¸­ç­‰</span>
                    </div>
                </div>
                <!-- æ–¹æ¡ˆæç¤º -->
                <div class="mt-4 p-3 bg-blue-50 border border-blue-100 rounded-lg text-sm text-primary">
                    <i class="fa fa-check-circle mr-1"></i> 
                    <strong>æ–¹æ¡ˆç‰¹æ€§</strong>ï¼šå¼•å…¥3ä¸ªè¾…åŠ©è¿›ç¨‹ï¼ˆPushersï¼‰è·Ÿè¸ªå…¨å±€èµ„æºçŠ¶æ€ï¼ŒåŸå­æ€§æ£€æµ‹èµ„æºç»„åˆï¼Œå½»åº•é¿å…æ­»é”
                </div>
            </div>

            <!-- æ¨¡æ‹ŸåŒºåŸŸ -->
            <div class="p-4 md:p-6">
                <div class="grid grid-cols-1 lg:grid-cols-5 gap-4 md:gap-6 relative">
                    <!-- ä»£ç† -->
                    <div class="lg:col-span-1 bg-white rounded-xl p-4 card-shadow card-hover" id="pn-agent-area">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-bold text-dark flex items-center">
                                <i class="fa fa-cogs text-primary mr-2"></i> ä»£ç† (Agent)
                            </h3>
                            <span id="pn-agentStatusBadge" class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">
                                å°±ç»ª
                            </span>
                        </div>
                        <div id="pn-agentState" class="p-3 bg-gray-50 rounded-lg text-gray-700 mb-3 text-center">
                            ç­‰å¾…å¼€å§‹
                        </div>
                        <div class="text-sm text-gray-600 mb-2">
                            <i class="fa fa-list-alt text-primary mr-1"></i> è¾…åŠ©è¿›ç¨‹çŠ¶æ€ï¼š
                        </div>
                        <div class="text-xs text-gray-500 space-y-1">
                            <div>isTobacco: <span id="pn-isTobacco">false</span></div>
                            <div>isPaper: <span id="pn-isPaper">false</span></div>
                            <div>isMatch: <span id="pn-isMatch">false</span></div>
                        </div>
                    </div>

                    <!-- æ¡Œé¢ï¼ˆå…±äº«èµ„æºåŒºï¼‰ -->
                    <div class="lg:col-span-3 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-5 card-shadow flex flex-col" id="pn-table-area">
                        <h3 class="text-lg font-bold text-dark mb-4 flex items-center">
                            <i class="fa fa-table text-primary mr-2"></i> å…±äº«æ¡Œé¢ï¼ˆèµ„æºæ ¼å­ï¼‰
                        </h3>
                        <div class="flex-grow flex flex-col items-center justify-center">
                            <div class="w-full max-w-md h-48 bg-white rounded-lg card-shadow p-4 mb-4">
                                <div class="grid grid-cols-3 gap-4 h-full">
                                    <!-- çƒŸè‰æ ¼å­ -->
                                    <div id="pn-tobacco-cell" class="resource-grid-cell border-2 border-gray-200 rounded-lg flex flex-col items-center justify-center">
                                        <span class="text-green-600 text-2xl mb-1">ğŸŒ¿</span>
                                        <span class="text-xs text-gray-500">çƒŸè‰</span>
                                        <div id="pn-tobacco-content" class="mt-2 opacity-0 transition-opacity duration-300">
                                            <span class="text-green-600 text-3xl">ğŸŒ¿</span>
                                        </div>
                                    </div>
                                    <!-- çº¸æ ¼å­ -->
                                    <div id="pn-paper-cell" class="resource-grid-cell border-2 border-gray-200 rounded-lg flex flex-col items-center justify-center">
                                        <span class="text-gray-600 text-2xl mb-1">ğŸ“„</span>
                                        <span class="text-xs text-gray-500">çº¸</span>
                                        <div id="pn-paper-content" class="mt-2 opacity-0 transition-opacity duration-300">
                                            <span class="text-gray-600 text-3xl">ğŸ“„</span>
                                        </div>
                                    </div>
                                    <!-- ç«æŸ´æ ¼å­ -->
                                    <div id="pn-match-cell" class="resource-grid-cell border-2 border-gray-200 rounded-lg flex flex-col items-center justify-center">
                                        <span class="text-orange-500 text-2xl mb-1">ğŸ”¥</span>
                                        <span class="text-xs text-gray-500">ç«æŸ´</span>
                                        <div id="pn-match-content" class="mt-2 opacity-0 transition-opacity duration-300">
                                            <span class="text-orange-500 text-3xl">ğŸ”¥</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- ç»Ÿè®¡é¢æ¿ -->
                        <div class="mt-6 grid grid-cols-3 gap-3">
                            <div class="bg-white p-3 rounded-lg card-shadow">
                                <p class="text-xs text-gray-500 mb-1">å¸çƒŸè€…A</p>
                                <div class="flex items-center">
                                    <span id="pn-smokerACount" class="text-xl font-bold text-secondary">0</span>
                                    <span class="text-sm text-gray-500 ml-1">æ¬¡å¸çƒŸ</span>
                                </div>
                            </div>
                            <div class="bg-white p-3 rounded-lg card-shadow">
                                <p class="text-xs text-gray-500 mb-1">å¸çƒŸè€…B</p>
                                <div class="flex items-center">
                                    <span id="pn-smokerBCount" class="text-xl font-bold text-secondary">0</span>
                                    <span class="text-sm text-gray-500 ml-1">æ¬¡å¸çƒŸ</span>
                                </div>
                            </div>
                            <div class="bg-white p-3 rounded-lg card-shadow">
                                <p class="text-xs text-gray-500 mb-1">å¸çƒŸè€…C</p>
                                <div class="flex items-center">
                                    <span id="pn-smokerCCount" class="text-xl font-bold text-secondary">0</span>
                                    <span class="text-sm text-gray-500 ml-1">æ¬¡å¸çƒŸ</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å¸çƒŸè€…åŒºåŸŸ -->
                    <div class="lg:col-span-1 flex flex-col gap-4">
                        <!-- å¸çƒŸè€…Aï¼ˆæŒçƒŸè‰ï¼‰ -->
                        <div class="bg-white rounded-xl p-4 card-shadow card-hover" id="pn-smokerA-area">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-lg font-bold text-dark">å¸çƒŸè€…A</h3>
                                <span id="pn-smokerAStatusBadge" class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">
                                    ç­‰å¾…
                                </span>
                            </div>
                            <p class="text-sm text-gray-600 mb-1">
                                <i class="fa fa-leaf text-green-600 mr-1"></i> æŒæœ‰ï¼šçƒŸè‰
                            </p>
                            <p class="text-sm text-gray-600 mb-3">
                                <i class="fa fa-arrow-right text-primary mr-1"></i> éœ€è·å–ï¼šçº¸ + ç«æŸ´
                            </p>
                            <div id="pn-smokerAState" class="p-2 bg-gray-50 rounded-lg text-gray-700 text-center text-sm">
                                ç­‰å¾…èµ„æº
                            </div>
                        </div>
                        <!-- å¸çƒŸè€…Bï¼ˆæŒçº¸ï¼‰ -->
                        <div class="bg-white rounded-xl p-4 card-shadow card-hover" id="pn-smokerB-area">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-lg font-bold text-dark">å¸çƒŸè€…B</h3>
                                <span id="pn-smokerBStatusBadge" class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">
                                    ç­‰å¾…
                                </span>
                            </div>
                            <p class="text-sm text-gray-600 mb-1">
                                <i class="fa fa-file-text-o text-gray-600 mr-1"></i> æŒæœ‰ï¼šçº¸
                            </p>
                            <p class="text-sm text-gray-600 mb-3">
                                <i class="fa fa-arrow-right text-primary mr-1"></i> éœ€è·å–ï¼šçƒŸè‰ + ç«æŸ´
                            </p>
                            <div id="pn-smokerBState" class="p-2 bg-gray-50 rounded-lg text-gray-700 text-center text-sm">
                                ç­‰å¾…èµ„æº
                            </div>
                        </div>
                        <!-- å¸çƒŸè€…Cï¼ˆæŒç«æŸ´ï¼‰ -->
                        <div class="bg-white rounded-xl p-4 card-shadow card-hover" id="pn-smokerC-area">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-lg font-bold text-dark">å¸çƒŸè€…C</h3>
                                <span id="pn-smokerCStatusBadge" class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">
                                    ç­‰å¾…
                                </span>
                            </div>
                            <p class="text-sm text-gray-600 mb-1">
                                <i class="fa fa-fire text-orange-500 mr-1"></i> æŒæœ‰ï¼šç«æŸ´
                            </p>
                            <p class="text-sm text-gray-600 mb-3">
                                <i class="fa fa-arrow-right text-primary mr-1"></i> éœ€è·å–ï¼šçƒŸè‰ + çº¸
                            </p>
                            <div id="pn-smokerCState" class="p-2 bg-gray-50 rounded-lg text-gray-700 text-center text-sm">
                                ç­‰å¾…èµ„æº
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ—¥å¿—åŒºåŸŸ -->
            <div class="p-4 md:p-6 border-t border-gray-100 bg-gray-50">
                <h3 class="text-lg font-bold text-dark mb-4 flex items-center">
                    <i class="fa fa-history text-primary mr-2"></i> æ¨¡æ‹Ÿæ—¥å¿—ï¼ˆParnasè¾…åŠ©è¿›ç¨‹æ–¹æ¡ˆï¼‰
                </h3>
                <div id="pn-log-area" class="h-64 bg-white rounded-xl p-4 overflow-y-auto card-shadow">
                    <div class="log-item log-system fade-in">
                        <span class="log-time text-gray-400">[ç³»ç»Ÿåˆå§‹åŒ–]</span>
                        <span>Parnasæ–¹æ¡ˆå°±ç»ªï¼Œç‚¹å‡»ã€Œå¼€å§‹æ¨¡æ‹Ÿã€å¯åŠ¨ï¼ˆæ— æ­»é”ï¼‰</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ–¹æ¡ˆ3ï¼šPetriç½‘æŠ‘åˆ¶å¼§æ–¹æ¡ˆï¼ˆæ— æ­»é”ï¼‰ -->
        <div id="scheme-petri" class="hidden">
            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="bg-gray-50 border-b border-gray-100 p-4 md:p-6">
                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="flex items-center space-x-3">
                        <button id="pt-startBtn" class="bg-secondary hover:bg-green-600 text-white font-medium py-2 px-6 rounded-lg transition-all duration-300 flex items-center">
                            <i class="fa fa-play mr-2"></i> å¼€å§‹æ¨¡æ‹Ÿ
                        </button>
                        <button id="pt-pauseBtn" class="bg-warning hover:bg-amber-600 text-white font-medium py-2 px-6 rounded-lg transition-all duration-300 flex items-center opacity-50 cursor-not-allowed" disabled>
                            <i class="fa fa-pause mr-2"></i> æš‚åœæ¨¡æ‹Ÿ
                        </button>
                        <button id="pt-resetBtn" class="bg-danger hover:bg-red-600 text-white font-medium py-2 px-6 rounded-lg transition-all duration-300 flex items-center">
                            <i class="fa fa-refresh mr-2"></i> é‡ç½®æ¨¡æ‹Ÿ
                        </button>
                    </div>
                    <div class="flex items-center gap-3 w-full md:w-auto">
                        <label for="pt-speedControl" class="text-gray-700 font-medium whitespace-nowrap">æ¨¡æ‹Ÿé€Ÿåº¦:</label>
                        <input type="range" id="pt-speedControl" min="1" max="10" value="5" class="w-full md:w-40 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-petri">
                        <span id="pt-speedValue" class="text-gray-700 font-medium min-w-[3rem] text-center">ä¸­ç­‰</span>
                    </div>
                </div>
                <!-- æ–¹æ¡ˆæç¤º -->
                <div class="mt-4 p-3 bg-purple-50 border border-purple-100 rounded-lg text-sm text-petri">
                    <i class="fa fa-shield mr-1"></i> 
                    <strong>æ–¹æ¡ˆç‰¹æ€§</strong>ï¼šé€šè¿‡æŠ‘åˆ¶å¼§ï¼ˆP4â†’T1ï¼‰çº¦æŸä»£ç†è¡Œä¸ºï¼Œä»…å½“å¸çƒŸå®Œæˆï¼ˆP4æœ‰æ ‡è®°ï¼‰æ—¶æŠ•æ”¾èµ„æºï¼Œå½¢å¼åŒ–éªŒè¯æ— æ­»é”
                </div>
            </div>

            <!-- æ¨¡æ‹ŸåŒºåŸŸ -->
            <div class="p-4 md:p-6">
                <div class="grid grid-cols-1 lg:grid-cols-5 gap-4 md:gap-6 relative">
                    <!-- ä»£ç† + Petriç½‘åº“æ‰€çŠ¶æ€ -->
                    <div class="lg:col-span-1 bg-white rounded-xl p-4 card-shadow card-hover" id="pt-agent-area">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-bold text-dark flex items-center">
                                <i class="fa fa-cogs text-petri mr-2"></i> ä»£ç† (Agent)
                            </h3>
                            <span id="pt-agentStatusBadge" class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">
                                å°±ç»ª
                            </span>
                        </div>
                        <div id="pt-agentState" class="p-3 bg-gray-50 rounded-lg text-gray-700 mb-3 text-center">
                            ç­‰å¾…å¼€å§‹
                        </div>
                        <div class="text-sm text-gray-600 mb-2">
                            <i class="fa fa-circle-o text-petri mr-1"></i> Petriç½‘åº“æ‰€ï¼ˆTokenæ•°ï¼‰ï¼š
                        </div>
                        <div class="text-xs text-gray-500 space-y-1">
                            <div>P1(çƒŸè‰): <span id="pt-P1">0</span></div>
                            <div>P2(çº¸): <span id="pt-P2">0</span></div>
                            <div>P3(ç«æŸ´): <span id="pt-P3">0</span></div>
                            <div>P4(ä»£ç†å°±ç»ª): <span id="pt-P4">1</span></div>
                        </div>
                        <div class="mt-3 p-2 bg-purple-50 rounded-lg text-xs text-petri text-center">
                            æŠ‘åˆ¶å¼§ï¼šP4â†’T1ï¼ˆP4=1æ—¶å…è®¸æŠ•æ”¾ï¼‰
                        </div>
                    </div>

                    <!-- æ¡Œé¢ï¼ˆå…±äº«èµ„æºåŒºï¼‰ -->
                    <div class="lg:col-span-3 bg-gradient-to-br from-purple-50 to-indigo-50 rounded-xl p-5 card-shadow flex flex-col" id="pt-table-area">
                        <h3 class="text-lg font-bold text-dark mb-4 flex items-center">
                            <i class="fa fa-table text-petri mr-2"></i> å…±äº«æ¡Œé¢ï¼ˆèµ„æºæ ¼å­ï¼‰
                        </h3>
                        <div class="flex-grow flex flex-col items-center justify-center">
                            <div class="w-full max-w-md h-48 bg-white rounded-lg card-shadow p-4 mb-4">
                                <div class="grid grid-cols-3 gap-4 h-full">
                                    <!-- çƒŸè‰æ ¼å­ -->
                                    <div id="pt-tobacco-cell" class="resource-grid-cell border-2 border-gray-200 rounded-lg flex flex-col items-center justify-center">
                                        <span class="text-green-600 text-2xl mb-1">ğŸŒ¿</span>
                                        <span class="text-xs text-gray-500">çƒŸè‰ï¼ˆP1ï¼‰</span>
                                        <div id="pt-tobacco-content" class="mt-2 opacity-0 transition-opacity duration-300">
                                            <span class="text-green-600 text-3xl">ğŸŒ¿</span>
                                        </div>
                                    </div>
                                    <!-- çº¸æ ¼å­ -->
                                    <div id="pt-paper-cell" class="resource-grid-cell border-2 border-gray-200 rounded-lg flex flex-col items-center justify-center">
                                        <span class="text-gray-600 text-2xl mb-1">ğŸ“„</span>
                                        <span class="text-xs text-gray-500">çº¸ï¼ˆP2ï¼‰</span>
                                        <div id="pt-paper-content" class="mt-2 opacity-0 transition-opacity duration-300">
                                            <span class="text-gray-600 text-3xl">ğŸ“„</span>
                                        </div>
                                    </div>
                                    <!-- ç«æŸ´æ ¼å­ -->
                                    <div id="pt-match-cell" class="resource-grid-cell border-2 border-gray-200 rounded-lg flex flex-col items-center justify-center">
                                        <span class="text-orange-500 text-2xl mb-1">ğŸ”¥</span>
                                        <span class="text-xs text-gray-500">ç«æŸ´ï¼ˆP3ï¼‰</span>
                                        <div id="pt-match-content" class="mt-2 opacity-0 transition-opacity duration-300">
                                            <span class="text-orange-500 text-3xl">ğŸ”¥</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- ç»Ÿè®¡é¢æ¿ -->
                        <div class="mt-6 grid grid-cols-3 gap-3">
                            <div class="bg-white p-3 rounded-lg card-shadow">
                                <p class="text-xs text-gray-500 mb-1">å¸çƒŸè€…A</p>
                                <div class="flex items-center">
                                    <span id="pt-smokerACount" class="text-xl font-bold text-secondary">0</span>
                                    <span class="text-sm text-gray-500 ml-1">æ¬¡å¸çƒŸ</span>
                                </div>
                            </div>
                            <div class="bg-white p-3 rounded-lg card-shadow">
                                <p class="text-xs text-gray-500 mb-1">å¸çƒŸè€…B</p>
                                <div class="flex items-center">
                                    <span id="pt-smokerBCount" class="text-xl font-bold text-secondary">0</span>
                                    <span class="text-sm text-gray-500 ml-1">æ¬¡å¸çƒŸ</span>
                                </div>
                            </div>
                            <div class="bg-white p-3 rounded-lg card-shadow">
                                <p class="text-xs text-gray-500 mb-1">å¸çƒŸè€…C</p>
                                <div class="flex items-center">
                                    <span id="pt-smokerCCount" class="text-xl font-bold text-secondary">0</span>
                                    <span class="text-sm text-gray-500 ml-1">æ¬¡å¸çƒŸ</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å¸çƒŸè€…åŒºåŸŸ -->
                    <div class="lg:col-span-1 flex flex-col gap-4">
                        <!-- å¸çƒŸè€…Aï¼ˆæŒçƒŸè‰ï¼‰ -->
                        <div class="bg-white rounded-xl p-4 card-shadow card-hover" id="pt-smokerA-area">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-lg font-bold text-dark">å¸çƒŸè€…A</h3>
                                <span id="pt-smokerAStatusBadge" class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">
                                    ç­‰å¾…
                                </span>
                            </div>
                            <p class="text-sm text-gray-600 mb-1">
                                <i class="fa fa-leaf text-green-600 mr-1"></i> æŒæœ‰ï¼šçƒŸè‰
                            </p>
                            <p class="text-sm text-gray-600 mb-3">
                                <i class="fa fa-arrow-right text-petri mr-1"></i> éœ€è·å–ï¼šçº¸ + ç«æŸ´
                            </p>
                            <div id="pt-smokerAState" class="p-2 bg-gray-50 rounded-lg text-gray-700 text-center text-sm">
                                ç­‰å¾…èµ„æº
                            </div>
                        </div>
                        <!-- å¸çƒŸè€…Bï¼ˆæŒçº¸ï¼‰ -->
                        <div class="bg-white rounded-xl p-4 card-shadow card-hover" id="pt-smokerB-area">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-lg font-bold text-dark">å¸çƒŸè€…B</h3>
                                <span id="pt-smokerBStatusBadge" class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">
                                    ç­‰å¾…
                                </span>
                            </div>
                            <p class="text-sm text-gray-600 mb-1">
                                <i class="fa fa-file-text-o text-gray-600 mr-1"></i> æŒæœ‰ï¼šçº¸
                            </p>
                            <p class="text-sm text-gray-600 mb-3">
                                <i class="fa fa-arrow-right text-petri mr-1"></i> éœ€è·å–ï¼šçƒŸè‰ + ç«æŸ´
                            </p>
                            <div id="pt-smokerBState" class="p-2 bg-gray-50 rounded-lg text-gray-700 text-center text-sm">
                                ç­‰å¾…èµ„æº
                            </div>
                        </div>
                        <!-- å¸çƒŸè€…Cï¼ˆæŒç«æŸ´ï¼‰ -->
                        <div class="bg-white rounded-xl p-4 card-shadow card-hover" id="pt-smokerC-area">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-lg font-bold text-dark">å¸çƒŸè€…C</h3>
                                <span id="pt-smokerCStatusBadge" class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">
                                    ç­‰å¾…
                                </span>
                            </div>
                            <p class="text-sm text-gray-600 mb-1">
                                <i class="fa fa-fire text-orange-500 mr-1"></i> æŒæœ‰ï¼šç«æŸ´
                            </p>
                            <p class="text-sm text-gray-600 mb-3">
                                <i class="fa fa-arrow-right text-petri mr-1"></i> éœ€è·å–ï¼šçƒŸè‰ + çº¸
                            </p>
                            <div id="pt-smokerCState" class="p-2 bg-gray-50 rounded-lg text-gray-700 text-center text-sm">
                                ç­‰å¾…èµ„æº
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ—¥å¿—åŒºåŸŸ -->
            <div class="p-4 md:p-6 border-t border-gray-100 bg-gray-50">
                <h3 class="text-lg font-bold text-dark mb-4 flex items-center">
                    <i class="fa fa-history text-petri mr-2"></i> æ¨¡æ‹Ÿæ—¥å¿—ï¼ˆPetriç½‘æŠ‘åˆ¶å¼§æ–¹æ¡ˆï¼‰
                </h3>
                <div id="pt-log-area" class="h-64 bg-white rounded-xl p-4 overflow-y-auto card-shadow">
                    <div class="log-item log-system fade-in">
                        <span class="log-time text-gray-400">[ç³»ç»Ÿåˆå§‹åŒ–]</span>
                        <span>Petriç½‘æ–¹æ¡ˆå°±ç»ªï¼Œç‚¹å‡»ã€Œå¼€å§‹æ¨¡æ‹Ÿã€å¯åŠ¨ï¼ˆæŠ‘åˆ¶å¼§ä¿éšœæ— æ­»é”ï¼‰</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // -------------------------- é€šç”¨å·¥å…·å‡½æ•° --------------------------
        // æ·»åŠ æ—¥å¿—
        function addLog(logAreaId, content, type = 'system', scheme = 'parnas') {
            const logArea = document.getElementById(logAreaId);
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-CN', { hour12: false });
            const logItem = document.createElement('div');
            logItem.className = `log-item log-${type} mb-2 p-3 rounded-lg fade-in`;
            
            // æŒ‰æ–¹æ¡ˆåŒºåˆ†æ—¥å¿—æ ·å¼
            if (type === 'agent') {
                if (scheme === 'deadlock') logItem.classList.add('bg-red-50', 'border-l-4', 'border-danger');
                if (scheme === 'parnas') logItem.classList.add('bg-blue-50', 'border-l-4', 'border-primary');
                if (scheme === 'petri') logItem.classList.add('bg-purple-50', 'border-l-4', 'border-petri');
            } else if (type === 'smoker') {
                logItem.classList.add('bg-green-50', 'border-l-4', 'border-secondary');
            } else if (type === 'deadlock') {
                logItem.classList.add('bg-red-50', 'border-l-4', 'border-danger', 'text-danger');
            } else {
                logItem.classList.add('bg-gray-50', 'border-l-4', 'border-gray-300', 'text-gray-600');
            }
            
            logItem.innerHTML = `<span class="log-time text-gray-400 mr-2">[${timeStr}]</span> ${content}`;
            logArea.appendChild(logItem);
            logArea.scrollTop = logArea.scrollHeight;
        }

        // åˆ›å»ºèµ„æºåŠ¨ç”»ï¼ˆä»£ç†â†’æ¡Œé¢ï¼‰
        function animateResourceToTable(schemePrefix, resourceType) {
            return new Promise((resolve) => {
                const agentArea = document.getElementById(`${schemePrefix}-agent-area`);
                const cellEl = document.getElementById(`${schemePrefix}-${resourceType}-cell`);
                const animationContainer = document.getElementById('resource-animation-container');
                
                // è·å–ç›¸å¯¹äºè§†å£çš„ä½ç½®ï¼ˆè§£å†³æ»šåŠ¨é—®é¢˜ï¼‰
                const agentRect = agentArea.getBoundingClientRect();
                const cellRect = cellEl.getBoundingClientRect();
                
                // åˆ›å»ºèµ„æºå…ƒç´ 
                const resourceEl = document.createElement('div');
                resourceEl.className = 'resource-item';
                resourceEl.dataset.scheme = schemePrefix;
                resourceEl.dataset.type = resourceType;
                
                if (resourceType === 'tobacco') {
                    resourceEl.innerHTML = 'ğŸŒ¿';
                    resourceEl.classList.add('text-green-600', 'text-2xl');
                } else if (resourceType === 'paper') {
                    resourceEl.innerHTML = 'ğŸ“„';
                    resourceEl.classList.add('text-gray-600', 'text-2xl');
                } else {
                    resourceEl.innerHTML = 'ğŸ”¥';
                    resourceEl.classList.add('text-orange-500', 'text-2xl');
                }
                
                // åˆå§‹ä½ç½®ï¼ˆä»£ç†ä¸­å¿ƒï¼‰
                resourceEl.style.left = `${agentRect.left + agentRect.width / 2}px`;
                resourceEl.style.top = `${agentRect.top + agentRect.height / 2}px`;
                animationContainer.appendChild(resourceEl);
                
                // åŠ¨ç”»åˆ°æ¡Œé¢æ ¼å­
                setTimeout(() => {
                    resourceEl.style.left = `${cellRect.left + cellRect.width / 2}px`;
                    resourceEl.style.top = `${cellRect.top + cellRect.height / 2}px`;
                    resourceEl.classList.add('resource-to-table');
                    
                    // åŠ¨ç”»å®Œæˆï¼šæ˜¾ç¤ºæ ¼å­èµ„æº
                    setTimeout(() => {
                        const contentEl = document.getElementById(`${schemePrefix}-${resourceType}-content`);
                        contentEl.classList.remove('opacity-0');
                        contentEl.classList.add('opacity-100');
                        cellEl.classList.add('filled');
                        if (schemePrefix === 'pt') cellEl.classList.add('petri-filled');
                        resolve(resourceEl);
                    }, 800);
                }, 50);
            });
        }

        // åˆ›å»ºèµ„æºåŠ¨ç”»ï¼ˆæ¡Œé¢â†’å¸çƒŸè€…ï¼‰
        function animateResourceToSmoker(resourceEl, schemePrefix, smokerId) {
            return new Promise((resolve) => {
                const resourceType = resourceEl.dataset.type;
                const smokerArea = document.getElementById(`${schemePrefix}-smoker${smokerId}-area`);
                const cellEl = document.getElementById(`${schemePrefix}-${resourceType}-cell`);
                const contentEl = document.getElementById(`${schemePrefix}-${resourceType}-content`);
                
                // éšè—æ ¼å­èµ„æº
                contentEl.classList.remove('opacity-100');
                contentEl.classList.add('opacity-0');
                cellEl.classList.remove('filled', 'petri-filled');
                
                const smokerRect = smokerArea.getBoundingClientRect();
                
                // åŠ¨ç”»åˆ°å¸çƒŸè€…
                resourceEl.classList.remove('resource-to-table');
                setTimeout(() => {
                    resourceEl.classList.add('resource-to-smoker');
                    resourceEl.style.left = `${smokerRect.left + smokerRect.width / 2}px`;
                    resourceEl.style.top = `${smokerRect.top + smokerRect.height / 2}px`;
                    
                    // èµ„æºæ¶ˆå¤±
                    setTimeout(() => {
                        resourceEl.classList.add('resource-disappear');
                        setTimeout(() => {
                            if (resourceEl.parentNode) resourceEl.parentNode.removeChild(resourceEl);
                            resolve();
                        }, 300);
                    }, 800);
                }, 50);
            });
        }

        // ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œæ›´æ–°èµ„æºä½ç½®
        function setupScrollHandler() {
            window.addEventListener('scroll', updateResourcePositions);
        }

        // æ›´æ–°æ‰€æœ‰èµ„æºå…ƒç´ çš„ä½ç½®ï¼ˆè§£å†³æ»šåŠ¨é—®é¢˜ï¼‰
        function updateResourcePositions() {
            const resources = document.querySelectorAll('.resource-item');
            resources.forEach(resource => {
                const scheme = resource.dataset.scheme;
                const type = resource.dataset.type;
                
                // æ£€æŸ¥èµ„æºå½“å‰åº”è¯¥åœ¨å“ªä¸ªä½ç½®
                if (resource.classList.contains('resource-to-table')) {
                    // èµ„æºåº”è¯¥åœ¨æ¡Œé¢æ ¼å­
                    const cellEl = document.getElementById(`${scheme}-${type}-cell`);
                    const cellRect = cellEl.getBoundingClientRect();
                    resource.style.left = `${cellRect.left + cellRect.width / 2}px`;
                    resource.style.top = `${cellRect.top + cellRect.height / 2}px`;
                } else if (resource.classList.contains('resource-to-smoker')) {
                    // èµ„æºåº”è¯¥åœ¨å¸çƒŸè€…å¤„ï¼ˆé€šè¿‡dataå±æ€§è·å–å¸çƒŸè€…IDï¼‰
                    const smokerId = resource.dataset.smoker;
                    if (smokerId) {
                        const smokerArea = document.getElementById(`${scheme}-smoker${smokerId}-area`);
                        const smokerRect = smokerArea.getBoundingClientRect();
                        resource.style.left = `${smokerRect.left + smokerRect.width / 2}px`;
                        resource.style.top = `${smokerRect.top + smokerRect.height / 2}px`;
                    }
                }
            });
        }

        // -------------------------- æ–¹æ¡ˆ1ï¼šä¼ ç»Ÿä¿¡å·é‡ï¼ˆæœ‰æ­»é”ï¼‰ --------------------------
        const DL = {
            isRunning: false,
            speed: 5,
            count: { A: 0, B: 0, C: 0 },
            semaphores: { paper: 0, match: 0, tobacco: 0, agent: 1 }, // ä¿¡å·é‡åˆå§‹å€¼
            timers: { agent: null, smoke: null },
            isDeadlock: false,
            waiting: { A: { hold: null, wait: null }, B: { hold: null, wait: null }, C: { hold: null, wait: null } },
            
            // åˆå§‹åŒ–
            init() {
                this.bindEvents();
                this.updateDOM();
            },
            
            // ç»‘å®šäº‹ä»¶
            bindEvents() {
                // æ§åˆ¶æŒ‰é’®
                document.getElementById('dl-startBtn').addEventListener('click', () => this.start());
                document.getElementById('dl-pauseBtn').addEventListener('click', () => this.pause());
                document.getElementById('dl-resetBtn').addEventListener('click', () => this.reset());
                
                // é€Ÿåº¦æ§åˆ¶
                document.getElementById('dl-speedControl').addEventListener('input', (e) => {
                    this.speed = parseInt(e.target.value);
                    const speedText = this.getSpeedText();
                    document.getElementById('dl-speedValue').textContent = speedText;
                    addLog('dl-log-area', `ç³»ç»Ÿï¼šæ¨¡æ‹Ÿé€Ÿåº¦è°ƒæ•´ä¸º${speedText}`, 'system', 'deadlock');
                });
            },
            
            // è·å–é€Ÿåº¦æ–‡æœ¬
            getSpeedText() {
                if (this.speed <= 2) return 'ææ…¢';
                if (this.speed <= 4) return 'æ…¢é€Ÿ';
                if (this.speed <= 6) return 'ä¸­ç­‰';
                if (this.speed <= 8) return 'å¿«é€Ÿ';
                return 'æå¿«';
            },
            
            // å¼€å§‹æ¨¡æ‹Ÿ
            start() {
                if (this.isRunning || this.isDeadlock) return;
                this.isRunning = true;
                document.getElementById('dl-startBtn').disabled = true;
                document.getElementById('dl-startBtn').classList.add('opacity-50', 'cursor-not-allowed');
                document.getElementById('dl-pauseBtn').disabled = false;
                document.getElementById('dl-pauseBtn').classList.remove('opacity-50', 'cursor-not-allowed');
                
                addLog('dl-log-area', 'ç³»ç»Ÿï¼šä¼ ç»Ÿä¿¡å·é‡æ–¹æ¡ˆæ¨¡æ‹Ÿå¼€å§‹ï¼ˆæ˜“è§¦å‘æ­»é”ï¼‰', 'system', 'deadlock');
                const delay = 1000 - (this.speed - 1) * 80;
                this.timers.agent = setTimeout(() => this.agentPutResources(), delay);
                this.updateDOM();
            },
            
            // æš‚åœæ¨¡æ‹Ÿ
            pause() {
                if (!this.isRunning || this.isDeadlock) return;
                this.isRunning = false;
                document.getElementById('dl-startBtn').disabled = false;
                document.getElementById('dl-startBtn').classList.remove('opacity-50', 'cursor-not-allowed');
                document.getElementById('dl-pauseBtn').disabled = true;
                document.getElementById('dl-pauseBtn').classList.add('opacity-50', 'cursor-not-allowed');
                
                clearTimeout(this.timers.agent);
                if (this.timers.smoke) clearTimeout(this.timers.smoke);
                addLog('dl-log-area', 'ç³»ç»Ÿï¼šæ¨¡æ‹Ÿæš‚åœ', 'system', 'deadlock');
                this.updateDOM();
            },
            
            // é‡ç½®æ¨¡æ‹Ÿ
            reset() {
                this.isRunning = false;
                this.isDeadlock = false;
                this.count = { A: 0, B: 0, C: 0 };
                this.semaphores = { paper: 0, match: 0, tobacco: 0, agent: 1 };
                this.waiting = { A: { hold: null, wait: null }, B: { hold: null, wait: null }, C: { hold: null, wait: null } };
                
                // æ¸…é™¤å®šæ—¶å™¨å’ŒåŠ¨ç”»
                clearTimeout(this.timers.agent);
                if (this.timers.smoke) clearTimeout(this.timers.smoke);
                const animations = document.querySelectorAll('[data-scheme="dl"]');
                animations.forEach(el => el.remove());
                
                // é‡ç½®UI
                document.getElementById('dl-deadlock-alert').classList.add('hidden');
                document.getElementById('dl-startBtn').disabled = false;
                document.getElementById('dl-startBtn').classList.remove('opacity-50', 'cursor-not-allowed');
                document.getElementById('dl-pauseBtn').disabled = true;
                document.getElementById('dl-pauseBtn').classList.add('opacity-50', 'cursor-not-allowed');
                
                // é‡ç½®èµ„æºæ ¼å­
                ['tobacco', 'paper', 'match'].forEach(r => {
                    const cell = document.getElementById(`dl-${r}-cell`);
                    const content = document.getElementById(`dl-${r}-content`);
                    cell.classList.remove('filled');
                    content.classList.remove('opacity-100');
                    content.classList.add('opacity-0');
                });
                
                // é‡ç½®æ—¥å¿—
                document.getElementById('dl-log-area').innerHTML = `
                    <div class="log-item log-system fade-in">
                        <span class="log-time text-gray-400">[ç³»ç»Ÿåˆå§‹åŒ–]</span>
                        <span>ä¼ ç»Ÿä¿¡å·é‡æ–¹æ¡ˆå°±ç»ªï¼Œç‚¹å‡»ã€Œå¼€å§‹æ¨¡æ‹Ÿã€å¯åŠ¨ï¼ˆæ˜“è§¦å‘æ­»é”ï¼‰</span>
                    </div>
                `;
                
                this.updateDOM();
                addLog('dl-log-area', 'ç³»ç»Ÿï¼šæ¨¡æ‹Ÿå·²é‡ç½®', 'system', 'deadlock');
            },
            
            // ä»£ç†æŠ•æ”¾èµ„æºï¼ˆéšæœºä¸¤ç§ï¼‰
            agentPutResources() {
                if (!this.isRunning || this.isDeadlock) return;
                
                // Pæ“ä½œï¼šä»£ç†ç­‰å¾…ï¼ˆç¡®ä¿ä¸€æ¬¡åªæœ‰ä¸€ä¸ªæŠ•æ”¾ï¼‰
                if (this.semaphores.agent <= 0) {
                    this.timers.agent = setTimeout(() => this.agentPutResources(), 200);
                    return;
                }
                this.semaphores.agent--;
                
                // éšæœºé€‰æ‹©ä¸¤ç§èµ„æº
                const resources = ['tobacco', 'paper', 'match'];
                const excludeIdx = Math.floor(Math.random() * 3);
                const putResources = resources.filter((_, idx) => idx !== excludeIdx);
                
                // Væ“ä½œï¼šé‡Šæ”¾èµ„æºä¿¡å·é‡
                putResources.forEach(r => this.semaphores[r]++);
                addLog('dl-log-area', `ä»£ç†ï¼šæŠ•æ”¾èµ„æºã€${this.getResourceName(putResources)}ã€‘ï¼Œ${this.getSemLog()}`, 'agent', 'deadlock');
                
                // æ‰§è¡ŒæŠ•æ”¾åŠ¨ç”»
                const animatePromises = putResources.map(r => animateResourceToTable('dl', r));
                Promise.all(animatePromises).then(() => {
                    // é€šçŸ¥å¸çƒŸè€…ç«äº‰èµ„æºï¼ˆéåŸå­æ€§ï¼‰
                    this.notifySmokers(putResources);
                });
            },
            
            // é€šçŸ¥å¸çƒŸè€…ç«äº‰èµ„æºï¼ˆæ ¸å¿ƒï¼šéåŸå­æ€§å¯¼è‡´æ­»é”ï¼‰
            notifySmokers(putResources) {
                if (this.isDeadlock) return;
                
                // æ¨¡æ‹Ÿå¸çƒŸè€…ç«äº‰ï¼ˆéšæœºé¡ºåºï¼ŒéåŸå­ï¼‰
                const smokers = ['A', 'B', 'C'];
                smokers.sort(() => Math.random() - 0.5); // éšæœºæ’åºï¼Œæ¨¡æ‹Ÿç«äº‰
                
                smokers.forEach(smokerId => {
                    if (this.isDeadlock) return;
                    const need = this.getSmokerNeed(smokerId);
                    // æ£€æŸ¥æ˜¯å¦éœ€è¦å½“å‰æŠ•æ”¾çš„èµ„æº
                    const hasAllNeed = need.every(r => putResources.includes(r));
                    if (!hasAllNeed) return;
                    
                    // å°è¯•è·å–èµ„æºï¼ˆéåŸå­Pæ“ä½œï¼‰
                    let gotOne = false;
                    need.forEach(r => {
                        if (this.semaphores[r] > 0) {
                            this.semaphores[r]--;
                            this.waiting[smokerId].hold = r; // è®°å½•æŒæœ‰èµ„æº
                            gotOne = true;
                            addLog('dl-log-area', `å¸çƒŸè€…${smokerId}ï¼šè·å–${this.getResourceName([r])}ï¼ˆ${this.getSemLog()}ï¼‰`, 'smoker', 'deadlock');
                        }
                    });
                    
                    // æ£€æŸ¥æ˜¯å¦è·å–å…¨éƒ¨èµ„æº
                    const hasAll = need.every(r => this.semaphores[r] === 0 && this.waiting[smokerId].hold === r);
                    if (hasAll) {
                        this.startSmoke(smokerId, need);
                    } else if (gotOne) {
                        // æŒæœ‰ä¸€ä¸ªèµ„æºï¼Œç­‰å¾…å¦ä¸€ä¸ªï¼ˆå¯èƒ½æ­»é”ï¼‰
                        this.waiting[smokerId].wait = need.find(r => this.semaphores[r] > 0 || this.waiting[smokerId].hold !== r);
                        addLog('dl-log-area', `å¸çƒŸè€…${smokerId}ï¼šæŒæœ‰${this.getResourceName([this.waiting[smokerId].hold])}ï¼Œç­‰å¾…${this.getResourceName([this.waiting[smokerId].wait])}`, 'smoker', 'deadlock');
                        this.checkDeadlock(); // æ£€æŸ¥æ­»é”
                    }
                });
            },
            
            // æ£€æŸ¥æ­»é”ï¼ˆæ¡ä»¶ï¼šè‡³å°‘ä¸¤ä¸ªå¸çƒŸè€…äº’ç›¸ç­‰å¾…ï¼‰
            checkDeadlock() {
                const waitingList = Object.entries(this.waiting).filter(([_, w]) => w.hold && w.wait);
                if (waitingList.length < 2) return;
                
                // æ­»é”æ¡ä»¶ï¼šAç­‰Bçš„èµ„æºï¼ŒBç­‰Açš„èµ„æº
                const [a, aWait] = waitingList[0];
                const [b, bWait] = waitingList[1];
                if (aWait.wait === bWait.hold && bWait.wait === aWait.hold) {
                    this.isDeadlock = true;
                    document.getElementById('dl-deadlock-alert').classList.remove('hidden');
                    addLog('dl-log-area', `æ­»é”ï¼šå¸çƒŸè€…${a}ï¼ˆæŒ${this.getResourceName([aWait.hold])}ç­‰${this.getResourceName([aWait.wait])}ï¼‰ä¸å¸çƒŸè€…${b}ï¼ˆæŒ${this.getResourceName([bWait.hold])}ç­‰${this.getResourceName([bWait.wait])}ï¼‰äº’ç›¸ç­‰å¾…`, 'deadlock', 'deadlock');
                    this.pause();
                }
            },
            
            // å¼€å§‹å¸çƒŸ
            startSmoke(smokerId, need) {
                if (this.isDeadlock) return;
                
                // æ›´æ–°çŠ¶æ€
                this.waiting[smokerId] = { hold: null, wait: null };
                document.getElementById(`dl-smoker${smokerId}State`).textContent = 'å¸çƒŸä¸­...';
                document.getElementById(`dl-smoker${smokerId}StatusBadge`).className = 'px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium';
                document.getElementById(`dl-smoker${smokerId}StatusBadge`).textContent = 'å¸çƒŸä¸­';
                
                // æ‰§è¡Œèµ„æºåŠ¨ç”»ï¼ˆæ¡Œé¢â†’å¸çƒŸè€…ï¼‰
                const resourceEls = document.querySelectorAll(`[data-scheme="dl"][data-type="${need[0]}"], [data-scheme="dl"][data-type="${need[1]}"]`);
                // ä¸ºèµ„æºæ·»åŠ å¸çƒŸè€…IDå±æ€§ï¼Œç”¨äºæ»šåŠ¨æ—¶å®šä½
                resourceEls.forEach(el => el.dataset.smoker = smokerId);
                const animatePromises = Array.from(resourceEls).map(el => animateResourceToSmoker(el, 'dl', smokerId));
                
                Promise.all(animatePromises).then(() => {
                    // å¸çƒŸå®Œæˆ
                    const smokeTime = 2000 - (this.speed - 1) * 150;
                    this.timers.smoke = setTimeout(() => {
                        this.count[smokerId]++;
                        addLog('dl-log-area', `å¸çƒŸè€…${smokerId}ï¼šå¸çƒŸå®Œæˆï¼ˆç´¯è®¡${this.count[smokerId]}æ¬¡ï¼‰ï¼Œé€šçŸ¥ä»£ç†`, 'smoker', 'deadlock');
                        
                        // Væ“ä½œï¼šé‡Šæ”¾ä»£ç†ä¿¡å·é‡
                        this.semaphores.agent++;
                        
                        // é‡ç½®å¸çƒŸè€…çŠ¶æ€
                        document.getElementById(`dl-smoker${smokerId}State`).textContent = 'ç­‰å¾…èµ„æº';
                        document.getElementById(`dl-smoker${smokerId}StatusBadge`).className = 'px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium';
                        document.getElementById(`dl-smoker${smokerId}StatusBadge`).textContent = 'ç­‰å¾…';
                        
                        // ç»§ç»­ä¸‹ä¸€è½®
                        if (this.isRunning) {
                            const delay = 1000 - (this.speed - 1) * 80;
                            this.timers.agent = setTimeout(() => this.agentPutResources(), delay);
                        }
                        this.updateDOM();
                    }, smokeTime);
                });
            },
            
            // è¾…åŠ©ï¼šè·å–èµ„æºåç§°
            getResourceName(resources) {
                return resources.map(r => {
                    return r === 'tobacco' ? 'çƒŸè‰' : r === 'paper' ? 'çº¸' : 'ç«æŸ´';
                }).join('+');
            },
            
            // è¾…åŠ©ï¼šè·å–ä¿¡å·é‡æ—¥å¿—
            getSemLog() {
                return `ä¿¡å·é‡ï¼špaper=${this.semaphores.paper}, match=${this.semaphores.match}, tobacco=${this.semaphores.tobacco}, agent=${this.semaphores.agent}`;
            },
            
            // è¾…åŠ©ï¼šè·å–å¸çƒŸè€…éœ€æ±‚
            getSmokerNeed(smokerId) {
                if (smokerId === 'A') return ['paper', 'match']; // æŒçƒŸè‰ï¼Œéœ€çº¸+ç«æŸ´
                if (smokerId === 'B') return ['tobacco', 'match']; // æŒçº¸ï¼Œéœ€çƒŸè‰+ç«æŸ´
                return ['tobacco', 'paper']; // æŒç«æŸ´ï¼Œéœ€çƒŸè‰+çº¸
            },
            
            // æ›´æ–°DOM
            updateDOM() {
                // æ›´æ–°ä¿¡å·é‡æ˜¾ç¤º
                document.getElementById('dl-paper-sem').textContent = this.semaphores.paper;
                document.getElementById('dl-match-sem').textContent = this.semaphores.match;
                document.getElementById('dl-tobacco-sem').textContent = this.semaphores.tobacco;
                document.getElementById('dl-agent-sem').textContent = this.semaphores.agent;
                
                // æ›´æ–°è®¡æ•°
                document.getElementById('dl-smokerACount').textContent = this.count.A;
                document.getElementById('dl-smokerBCount').textContent = this.count.B;
                document.getElementById('dl-smokerCCount').textContent = this.count.C;
                
                // æ›´æ–°ä»£ç†çŠ¶æ€
                if (this.isRunning) {
                    document.getElementById('dl-agentState').textContent = this.semaphores.agent > 0 ? 'ç­‰å¾…æŠ•æ”¾' : 'æŠ•æ”¾ä¸­';
                    document.getElementById('dl-agentStatusBadge').className = 'px-2 py-1 bg-red-100 text-danger rounded-full text-xs font-medium';
                    document.getElementById('dl-agentStatusBadge').textContent = 'è¿è¡Œä¸­';
                } else if (this.isDeadlock) {
                    document.getElementById('dl-agentState').textContent = 'æ­»é”çŠ¶æ€';
                    document.getElementById('dl-agentStatusBadge').className = 'px-2 py-1 bg-red-100 text-danger rounded-full text-xs font-medium';
                    document.getElementById('dl-agentStatusBadge').textContent = 'æ­»é”';
                } else {
                    document.getElementById('dl-agentState').textContent = 'å·²æš‚åœ';
                    document.getElementById('dl-agentStatusBadge').className = 'px-2 py-1 bg-amber-100 text-amber-700 rounded-full text-xs font-medium';
                    document.getElementById('dl-agentStatusBadge').textContent = 'å·²æš‚åœ';
                }
            }
        };

        // -------------------------- æ–¹æ¡ˆ2ï¼šParnasè¾…åŠ©è¿›ç¨‹ï¼ˆæ— æ­»é”ï¼‰ --------------------------
        const PN = {
            isRunning: false,
            speed: 5,
            count: { A: 0, B: 0, C: 0 },
            tableResources: { tobacco: false, paper: false, match: false },
            agentState: 'waiting', // waiting/running
            smokerStates: { A: 'waiting', B: 'waiting', C: 'waiting' }, // waiting/running
            timers: { agent: null, smoke: null },
            
            // åˆå§‹åŒ–
            init() {
                this.bindEvents();
                this.updateDOM();
            },
            
            // ç»‘å®šäº‹ä»¶
            bindEvents() {
                // æ§åˆ¶æŒ‰é’®
                document.getElementById('pn-startBtn').addEventListener('click', () => this.start());
                document.getElementById('pn-pauseBtn').addEventListener('click', () => this.pause());
                document.getElementById('pn-resetBtn').addEventListener('click', () => this.reset());
                
                // é€Ÿåº¦æ§åˆ¶
                document.getElementById('pn-speedControl').addEventListener('input', (e) => {
                    this.speed = parseInt(e.target.value);
                    const speedText = this.getSpeedText();
                    document.getElementById('pn-speedValue').textContent = speedText;
                    addLog('pn-log-area', `ç³»ç»Ÿï¼šæ¨¡æ‹Ÿé€Ÿåº¦è°ƒæ•´ä¸º${speedText}`, 'system', 'parnas');
                });
            },
            
            // è·å–é€Ÿåº¦æ–‡æœ¬
            getSpeedText() {
                if (this.speed <= 2) return 'ææ…¢';
                if (this.speed <= 4) return 'æ…¢é€Ÿ';
                if (this.speed <= 6) return 'ä¸­ç­‰';
                if (this.speed <= 8) return 'å¿«é€Ÿ';
                return 'æå¿«';
            },
            
            // å¼€å§‹æ¨¡æ‹Ÿ
            start() {
                if (this.isRunning) return;
                this.isRunning = true;
                document.getElementById('pn-startBtn').disabled = true;
                document.getElementById('pn-startBtn').classList.add('opacity-50', 'cursor-not-allowed');
                document.getElementById('pn-pauseBtn').disabled = false;
                document.getElementById('pn-pauseBtn').classList.remove('opacity-50', 'cursor-not-allowed');
                
                addLog('pn-log-area', 'ç³»ç»Ÿï¼šParnasè¾…åŠ©è¿›ç¨‹æ–¹æ¡ˆæ¨¡æ‹Ÿå¼€å§‹ï¼ˆæ— æ­»é”ï¼‰', 'system', 'parnas');
                const delay = 1000 - (this.speed - 1) * 80;
                this.timers.agent = setTimeout(() => this.agentPutResources(), delay);
                this.updateDOM();
            },
            
            // æš‚åœæ¨¡æ‹Ÿ
            pause() {
                if (!this.isRunning) return;
                this.isRunning = false;
                document.getElementById('pn-startBtn').disabled = false;
                document.getElementById('pn-startBtn').classList.remove('opacity-50', 'cursor-not-allowed');
                document.getElementById('pn-pauseBtn').disabled = true;
                document.getElementById('pn-pauseBtn').classList.add('opacity-50', 'cursor-not-allowed');
                
                clearTimeout(this.timers.agent);
                if (this.timers.smoke) clearTimeout(this.timers.smoke);
                addLog('pn-log-area', 'ç³»ç»Ÿï¼šæ¨¡æ‹Ÿæš‚åœ', 'system', 'parnas');
                this.updateDOM();
            },
            
            // é‡ç½®æ¨¡æ‹Ÿ
            reset() {
                this.isRunning = false;
                this.count = { A: 0, B: 0, C: 0 };
                this.tableResources = { tobacco: false, paper: false, match: false };
                this.agentState = 'waiting';
                this.smokerStates = { A: 'waiting', B: 'waiting', C: 'waiting' };
                
                // æ¸…é™¤å®šæ—¶å™¨å’ŒåŠ¨ç”»
                clearTimeout(this.timers.agent);
                if (this.timers.smoke) clearTimeout(this.timers.smoke);
                const animations = document.querySelectorAll('[data-scheme="pn"]');
                animations.forEach(el => el.remove());
                
                // é‡ç½®UI
                document.getElementById('pn-startBtn').disabled = false;
                document.getElementById('pn-startBtn').classList.remove('opacity-50', 'cursor-not-allowed');
                document.getElementById('pn-pauseBtn').disabled = true;
                document.getElementById('pn-pauseBtn').classList.add('opacity-50', 'cursor-not-allowed');
                
                // é‡ç½®èµ„æºæ ¼å­
                ['tobacco', 'paper', 'match'].forEach(r => {
                    const cell = document.getElementById(`pn-${r}-cell`);
                    const content = document.getElementById(`pn-${r}-content`);
                    cell.classList.remove('filled');
                    content.classList.remove('opacity-100');
                    content.classList.add('opacity-0');
                });
                
                // é‡ç½®æ—¥å¿—
                document.getElementById('pn-log-area').innerHTML = `
                    <div class="log-item log-system fade-in">
                        <span class="log-time text-gray-400">[ç³»ç»Ÿåˆå§‹åŒ–]</span>
                        <span>Parnasæ–¹æ¡ˆå°±ç»ªï¼Œç‚¹å‡»ã€Œå¼€å§‹æ¨¡æ‹Ÿã€å¯åŠ¨ï¼ˆæ— æ­»é”ï¼‰</span>
                    </div>
                `;
                
                this.updateDOM();
                addLog('pn-log-area', 'ç³»ç»Ÿï¼šæ¨¡æ‹Ÿå·²é‡ç½®', 'system', 'parnas');
            },
            
            // ä»£ç†æŠ•æ”¾èµ„æºï¼ˆéšæœºä¸¤ç§ï¼‰
            agentPutResources() {
                if (!this.isRunning) return;
                
                // æ¸…é™¤ç°æœ‰èµ„æº
                this.tableResources = { tobacco: false, paper: false, match: false };
                ['tobacco', 'paper', 'match'].forEach(r => {
                    const cell = document.getElementById(`pn-${r}-cell`);
                    const content = document.getElementById(`pn-${r}-content`);
                    cell.classList.remove('filled');
                    content.classList.remove('opacity-100');
                    content.classList.add('opacity-0');
                });
                
                // æ›´æ–°çŠ¶æ€
                this.agentState = 'running';
                addLog('pn-log-area', 'ä»£ç†ï¼šå¼€å§‹æŠ•æ”¾èµ„æº', 'agent', 'parnas');
                this.updateDOM();
                
                // éšæœºé€‰æ‹©ä¸¤ç§èµ„æº
                const resources = ['tobacco', 'paper', 'match'];
                const excludeIdx = Math.floor(Math.random() * 3);
                const putResources = resources.filter((_, idx) => idx !== excludeIdx);
                
                // è®¾ç½®æ¡Œé¢èµ„æºçŠ¶æ€
                putResources.forEach(r => this.tableResources[r] = true);
                
                // æ‰§è¡ŒæŠ•æ”¾åŠ¨ç”»
                const animatePromises = putResources.map(r => animateResourceToTable('pn', r));
                Promise.all(animatePromises).then(() => {
                    // è®°å½•æŠ•æ”¾æ—¥å¿—
                    const resourceNames = this.getResourceName(putResources);
                    addLog('pn-log-area', `ä»£ç†ï¼šæŠ•æ”¾èµ„æºã€${resourceNames}ã€‘ï¼Œè¾…åŠ©è¿›ç¨‹æ£€æµ‹ä¸­`, 'agent', 'parnas');
                    
                    // ä»£ç†åˆ‡æ¢ä¸ºç­‰å¾…çŠ¶æ€
                    this.agentState = 'waiting';
                    this.updateDOM();

                    // è¾…åŠ©è¿›ç¨‹åŸå­æ€§æ£€æµ‹èµ„æºç»„åˆ
                    const delay = 500 - (this.speed - 1) * 40;
                    setTimeout(() => this.checkResourcesAndWake(), delay);
                });
            },
            
            // è¾…åŠ©è¿›ç¨‹ï¼šåŸå­æ€§æ£€æµ‹èµ„æºç»„åˆå¹¶å”¤é†’å¯¹åº”å¸çƒŸè€…
            checkResourcesAndWake() {
                if (!this.isRunning) return;
                
                // åŸå­æ€§æ£€æµ‹ä¸‰ç§å¯èƒ½çš„èµ„æºç»„åˆ
                if (this.tableResources.paper && this.tableResources.match && this.smokerStates.A === 'waiting') {
                    // çº¸+ç«æŸ´ â†’ å”¤é†’å¸çƒŸè€…A
                    this.wakeSmoker('A', ['paper', 'match']);
                } else if (this.tableResources.tobacco && this.tableResources.match && this.smokerStates.B === 'waiting') {
                    // çƒŸè‰+ç«æŸ´ â†’ å”¤é†’å¸çƒŸè€…B
                    this.wakeSmoker('B', ['tobacco', 'match']);
                } else if (this.tableResources.tobacco && this.tableResources.paper && this.smokerStates.C === 'waiting') {
                    // çƒŸè‰+çº¸ â†’ å”¤é†’å¸çƒŸè€…C
                    this.wakeSmoker('C', ['tobacco', 'paper']);
                }
            },
            
            // å”¤é†’å¸çƒŸè€…å¹¶æ‰§è¡Œå¸çƒŸæµç¨‹
            wakeSmoker(smokerId, resources) {
                if (!this.isRunning) return;
                
                // æ›´æ–°çŠ¶æ€
                this.smokerStates[smokerId] = 'running';
                const resourceNames = this.getResourceName(resources);
                addLog('pn-log-area', `å¸çƒŸè€…${smokerId}ï¼šè·å–èµ„æºã€${resourceNames}ã€‘ï¼Œå¼€å§‹å¸çƒŸ`, 'smoker', 'parnas');
                this.updateDOM();

                // æ‰§è¡Œèµ„æºåŠ¨ç”»ï¼ˆæ¡Œé¢â†’å¸çƒŸè€…ï¼‰
                const resourceEls = document.querySelectorAll(`[data-scheme="pn"][data-type="${resources[0]}"], [data-scheme="pn"][data-type="${resources[1]}"]`);
                // ä¸ºèµ„æºæ·»åŠ å¸çƒŸè€…IDå±æ€§ï¼Œç”¨äºæ»šåŠ¨æ—¶å®šä½
                resourceEls.forEach(el => el.dataset.smoker = smokerId);
                const animatePromises = Array.from(resourceEls).map(el => animateResourceToSmoker(el, 'pn', smokerId));
                
                Promise.all(animatePromises).then(() => {
                    // æ¸…ç©ºæ¡Œé¢èµ„æº
                    resources.forEach(r => this.tableResources[r] = false);
                    
                    // æ¨¡æ‹Ÿå¸çƒŸæ—¶é—´
                    const smokeTime = 2000 - (this.speed - 1) * 150;
                    this.timers.smoke = setTimeout(() => {
                        // å¸çƒŸå®Œæˆ
                        this.count[smokerId]++;
                        this.smokerStates[smokerId] = 'waiting';
                        addLog('pn-log-area', `å¸çƒŸè€…${smokerId}ï¼šå¸çƒŸå®Œæˆï¼ˆç´¯è®¡${this.count[smokerId]}æ¬¡ï¼‰ï¼Œé€šçŸ¥ä»£ç†ç»§ç»­`, 'smoker', 'parnas');
                        
                        // ç»§ç»­ä¸‹ä¸€è½®
                        if (this.isRunning) {
                            const delay = 1000 - (this.speed - 1) * 80;
                            this.timers.agent = setTimeout(() => this.agentPutResources(), delay);
                        }
                        this.updateDOM();
                    }, smokeTime);
                });
            },
            
            // è¾…åŠ©ï¼šè·å–èµ„æºåç§°
            getResourceName(resources) {
                return resources.map(r => {
                    return r === 'tobacco' ? 'çƒŸè‰' : r === 'paper' ? 'çº¸' : 'ç«æŸ´';
                }).join('+');
            },
            
            // æ›´æ–°DOM
            updateDOM() {
                // æ›´æ–°è¾…åŠ©è¿›ç¨‹çŠ¶æ€æ˜¾ç¤º
                document.getElementById('pn-isTobacco').textContent = this.tableResources.tobacco;
                document.getElementById('pn-isPaper').textContent = this.tableResources.paper;
                document.getElementById('pn-isMatch').textContent = this.tableResources.match;
                
                // æ›´æ–°è®¡æ•°
                document.getElementById('pn-smokerACount').textContent = this.count.A;
                document.getElementById('pn-smokerBCount').textContent = this.count.B;
                document.getElementById('pn-smokerCCount').textContent = this.count.C;
                
                // æ›´æ–°ä»£ç†çŠ¶æ€
                if (this.agentState === 'running') {
                    document.getElementById('pn-agentState').textContent = 'æŠ•æ”¾èµ„æºä¸­';
                    document.getElementById('pn-agentStatusBadge').className = 'px-2 py-1 bg-blue-100 text-primary rounded-full text-xs font-medium';
                    document.getElementById('pn-agentStatusBadge').textContent = 'è¿è¡Œä¸­';
                } else if (this.isRunning) {
                    document.getElementById('pn-agentState').textContent = 'ç­‰å¾…å¸çƒŸå®Œæˆ';
                    document.getElementById('pn-agentStatusBadge').className = 'px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium';
                    document.getElementById('pn-agentStatusBadge').textContent = 'ç­‰å¾…ä¸­';
                } else {
                    document.getElementById('pn-agentState').textContent = 'å·²æš‚åœ';
                    document.getElementById('pn-agentStatusBadge').className = 'px-2 py-1 bg-amber-100 text-amber-700 rounded-full text-xs font-medium';
                    document.getElementById('pn-agentStatusBadge').textContent = 'å·²æš‚åœ';
                }
                
                // æ›´æ–°å¸çƒŸè€…çŠ¶æ€
                ['A', 'B', 'C'].forEach(id => {
                    const stateEl = document.getElementById(`pn-smoker${id}State`);
                    const badgeEl = document.getElementById(`pn-smoker${id}StatusBadge`);
                    
                    if (this.smokerStates[id] === 'running') {
                        stateEl.textContent = 'å¸çƒŸä¸­...';
                        badgeEl.className = 'px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium';
                        badgeEl.textContent = 'å¸çƒŸä¸­';
                    } else {
                        stateEl.textContent = 'ç­‰å¾…èµ„æº';
                        badgeEl.className = 'px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium';
                        badgeEl.textContent = 'ç­‰å¾…';
                    }
                });
            }
        };

        // -------------------------- æ–¹æ¡ˆ3ï¼šPetriç½‘æŠ‘åˆ¶å¼§ï¼ˆæ— æ­»é”ï¼‰ --------------------------
        const PT = {
            isRunning: false,
            speed: 5,
            count: { A: 0, B: 0, C: 0 },
            places: { P1: 0, P2: 0, P3: 0, P4: 1 }, // Petriç½‘åº“æ‰€ï¼ˆP4:ä»£ç†å°±ç»ªï¼‰
            timers: { agent: null, smoke: null },
            
            // åˆå§‹åŒ–
            init() {
                this.bindEvents();
                this.updateDOM();
            },
            
            // ç»‘å®šäº‹ä»¶
            bindEvents() {
                // æ§åˆ¶æŒ‰é’®
                document.getElementById('pt-startBtn').addEventListener('click', () => this.start());
                document.getElementById('pt-pauseBtn').addEventListener('click', () => this.pause());
                document.getElementById('pt-resetBtn').addEventListener('click', () => this.reset());
                
                // é€Ÿåº¦æ§åˆ¶
                document.getElementById('pt-speedControl').addEventListener('input', (e) => {
                    this.speed = parseInt(e.target.value);
                    const speedText = this.getSpeedText();
                    document.getElementById('pt-speedValue').textContent = speedText;
                    addLog('pt-log-area', `ç³»ç»Ÿï¼šæ¨¡æ‹Ÿé€Ÿåº¦è°ƒæ•´ä¸º${speedText}`, 'system', 'petri');
                });
            },
            
            // è·å–é€Ÿåº¦æ–‡æœ¬
            getSpeedText() {
                if (this.speed <= 2) return 'ææ…¢';
                if (this.speed <= 4) return 'æ…¢é€Ÿ';
                if (this.speed <= 6) return 'ä¸­ç­‰';
                if (this.speed <= 8) return 'å¿«é€Ÿ';
                return 'æå¿«';
            },
            
            // å¼€å§‹æ¨¡æ‹Ÿ
            start() {
                if (this.isRunning) return;
                this.isRunning = true;
                document.getElementById('pt-startBtn').disabled = true;
                document.getElementById('pt-startBtn').classList.add('opacity-50', 'cursor-not-allowed');
                document.getElementById('pt-pauseBtn').disabled = false;
                document.getElementById('pt-pauseBtn').classList.remove('opacity-50', 'cursor-not-allowed');
                
                addLog('pt-log-area', 'ç³»ç»Ÿï¼šPetriç½‘æŠ‘åˆ¶å¼§æ–¹æ¡ˆæ¨¡æ‹Ÿå¼€å§‹ï¼ˆæ— æ­»é”ï¼‰', 'system', 'petri');
                const delay = 1000 - (this.speed - 1) * 80;
                this.timers.agent = setTimeout(() => this.fireTransitionT1(), delay); // è§¦å‘T1è½¬æ¢ï¼ˆæŠ•æ”¾èµ„æºï¼‰
                this.updateDOM();
            },
            
            // æš‚åœæ¨¡æ‹Ÿ
            pause() {
                if (!this.isRunning) return;
                this.isRunning = false;
                document.getElementById('pt-startBtn').disabled = false;
                document.getElementById('pt-startBtn').classList.remove('opacity-50', 'cursor-not-allowed');
                document.getElementById('pt-pauseBtn').disabled = true;
                document.getElementById('pt-pauseBtn').classList.add('opacity-50', 'cursor-not-allowed');
                
                clearTimeout(this.timers.agent);
                if (this.timers.smoke) clearTimeout(this.timers.smoke);
                addLog('pt-log-area', 'ç³»ç»Ÿï¼šæ¨¡æ‹Ÿæš‚åœ', 'system', 'petri');
                this.updateDOM();
            },
            
            // é‡ç½®æ¨¡æ‹Ÿ
            reset() {
                this.isRunning = false;
                this.count = { A: 0, B: 0, C: 0 };
                this.places = { P1: 0, P2: 0, P3: 0, P4: 1 }; // é‡ç½®åº“æ‰€æ ‡è®°
                
                // æ¸…é™¤å®šæ—¶å™¨å’ŒåŠ¨ç”»
                clearTimeout(this.timers.agent);
                if (this.timers.smoke) clearTimeout(this.timers.smoke);
                const animations = document.querySelectorAll('[data-scheme="pt"]');
                animations.forEach(el => el.remove());
                
                // é‡ç½®UI
                document.getElementById('pt-startBtn').disabled = false;
                document.getElementById('pt-startBtn').classList.remove('opacity-50', 'cursor-not-allowed');
                document.getElementById('pt-pauseBtn').disabled = true;
                document.getElementById('pt-pauseBtn').classList.add('opacity-50', 'cursor-not-allowed');
                
                // é‡ç½®èµ„æºæ ¼å­
                ['tobacco', 'paper', 'match'].forEach(r => {
                    const cell = document.getElementById(`pt-${r}-cell`);
                    const content = document.getElementById(`pt-${r}-content`);
                    cell.classList.remove('filled', 'petri-filled');
                    content.classList.remove('opacity-100');
                    content.classList.add('opacity-0');
                });
                
                // é‡ç½®æ—¥å¿—
                document.getElementById('pt-log-area').innerHTML = `
                    <div class="log-item log-system fade-in">
                        <span class="log-time text-gray-400">[ç³»ç»Ÿåˆå§‹åŒ–]</span>
                        <span>Petriç½‘æ–¹æ¡ˆå°±ç»ªï¼Œç‚¹å‡»ã€Œå¼€å§‹æ¨¡æ‹Ÿã€å¯åŠ¨ï¼ˆæŠ‘åˆ¶å¼§ä¿éšœæ— æ­»é”ï¼‰</span>
                    </div>
                `;
                
                this.updateDOM();
                addLog('pt-log-area', 'ç³»ç»Ÿï¼šæ¨¡æ‹Ÿå·²é‡ç½®', 'system', 'petri');
            },
            
            // è§¦å‘T1è½¬æ¢ï¼ˆä»£ç†æŠ•æ”¾èµ„æºï¼Œå—æŠ‘åˆ¶å¼§P4â†’T1æ§åˆ¶ï¼‰
            fireTransitionT1() {
                if (!this.isRunning) return;
                
                // æŠ‘åˆ¶å¼§çº¦æŸï¼šåªæœ‰P4æœ‰æ ‡è®°æ—¶æ‰èƒ½è§¦å‘T1
                if (this.places.P4 !== 1) {
                    this.timers.agent = setTimeout(() => this.fireTransitionT1(), 200);
                    return;
                }
                
                // Petriç½‘è½¬æ¢ï¼šP4å‡å°‘1ä¸ªæ ‡è®°ï¼ˆä»£ç†å¼€å§‹å·¥ä½œï¼‰
                this.places.P4 = 0;
                addLog('pt-log-area', 'ä»£ç†ï¼šè§¦å‘T1è½¬æ¢ï¼ˆæŠ‘åˆ¶å¼§çº¦æŸé€šè¿‡ï¼‰ï¼Œå¼€å§‹æŠ•æ”¾èµ„æº', 'agent', 'petri');
                this.updateDOM();
                
                // éšæœºé€‰æ‹©ä¸¤ç§èµ„æºï¼ˆå¯¹åº”ä¸¤ä¸ªåº“æ‰€å¢åŠ æ ‡è®°ï¼‰
                const resources = [
                    {id: 'P1', type: 'tobacco'},
                    {id: 'P2', type: 'paper'},
                    {id: 'P3', type: 'match'}
                ];
                const excludeIdx = Math.floor(Math.random() * 3);
                const putResources = resources.filter((_, idx) => idx !== excludeIdx);
                
                // æ›´æ–°åº“æ‰€æ ‡è®°
                putResources.forEach(r => this.places[r.id] = 1);
                
                // æ‰§è¡ŒæŠ•æ”¾åŠ¨ç”»
                const animatePromises = putResources.map(r => animateResourceToTable('pt', r.type));
                Promise.all(animatePromises).then(() => {
                    const resourceNames = this.getResourceName(putResources.map(r => r.type));
                    addLog('pt-log-area', `ä»£ç†ï¼šæŠ•æ”¾èµ„æºã€${resourceNames}ã€‘ï¼ŒP1=${this.places.P1}, P2=${this.places.P2}, P3=${this.places.P3}, P4=${this.places.P4}`, 'agent', 'petri');
                    
                    // è§¦å‘å¯¹åº”çš„å¸çƒŸè½¬æ¢
                    this.fireSmokeTransition(putResources);
                });
            },
            
            // è§¦å‘å¸çƒŸè½¬æ¢ï¼ˆT2/T3/T4ï¼‰
            fireSmokeTransition(putResources) {
                if (!this.isRunning) return;
                
                // ç¡®å®šå¯¹åº”çš„å¸çƒŸè€…å’Œè½¬æ¢
                let smokerId, transitionId;
                if (putResources.some(r => r.id === 'P2') && putResources.some(r => r.id === 'P3')) {
                    smokerId = 'A'; // çº¸(P2)+ç«æŸ´(P3) â†’ å¸çƒŸè€…A
                    transitionId = 'T2';
                } else if (putResources.some(r => r.id === 'P1') && putResources.some(r => r.id === 'P3')) {
                    smokerId = 'B'; // çƒŸè‰(P1)+ç«æŸ´(P3) â†’ å¸çƒŸè€…B
                    transitionId = 'T3';
                } else {
                    smokerId = 'C'; // çƒŸè‰(P1)+çº¸(P2) â†’ å¸çƒŸè€…C
                    transitionId = 'T4';
                }
                
                // æ›´æ–°å¸çƒŸè€…çŠ¶æ€
                document.getElementById(`pt-smoker${smokerId}State`).textContent = 'å¸çƒŸä¸­...';
                document.getElementById(`pt-smoker${smokerId}StatusBadge`).className = 'px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium';
                document.getElementById(`pt-smoker${smokerId}StatusBadge`).textContent = 'å¸çƒŸä¸­';
                
                addLog('pt-log-area', `å¸çƒŸè€…${smokerId}ï¼šè§¦å‘${transitionId}è½¬æ¢ï¼Œå¼€å§‹å¸çƒŸ`, 'smoker', 'petri');
                
                // æ‰§è¡Œèµ„æºåŠ¨ç”»ï¼ˆæ¡Œé¢â†’å¸çƒŸè€…ï¼‰
                const resourceEls = document.querySelectorAll(`[data-scheme="pt"][data-type="${putResources[0].type}"], [data-scheme="pt"][data-type="${putResources[1].type}"]`);
                // ä¸ºèµ„æºæ·»åŠ å¸çƒŸè€…IDå±æ€§ï¼Œç”¨äºæ»šåŠ¨æ—¶å®šä½
                resourceEls.forEach(el => el.dataset.smoker = smokerId);
                const animatePromises = Array.from(resourceEls).map(el => animateResourceToSmoker(el, 'pt', smokerId));
                
                Promise.all(animatePromises).then(() => {
                    // Petriç½‘è½¬æ¢ï¼šæ¸…é™¤èµ„æºåº“æ‰€æ ‡è®°
                    putResources.forEach(r => this.places[r.id] = 0);
                    
                    // æ¨¡æ‹Ÿå¸çƒŸæ—¶é—´
                    const smokeTime = 2000 - (this.speed - 1) * 150;
                    this.timers.smoke = setTimeout(() => {
                        // å¸çƒŸå®Œæˆï¼ŒPetriç½‘è½¬æ¢ï¼šæ¢å¤P4æ ‡è®°ï¼ˆä»£ç†å°±ç»ªï¼‰
                        this.count[smokerId]++;
                        this.places.P4 = 1;
                        
                        // é‡ç½®å¸çƒŸè€…çŠ¶æ€
                        document.getElementById(`pt-smoker${smokerId}State`).textContent = 'ç­‰å¾…èµ„æº';
                        document.getElementById(`pt-smoker${smokerId}StatusBadge`).className = 'px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium';
                        document.getElementById(`pt-smoker${smokerId}StatusBadge`).textContent = 'ç­‰å¾…';
                        
                        addLog('pt-log-area', `å¸çƒŸè€…${smokerId}ï¼šå¸çƒŸå®Œæˆï¼ˆç´¯è®¡${this.count[smokerId]}æ¬¡ï¼‰ï¼Œ${transitionId}è½¬æ¢ç»“æŸï¼ŒP4æ¢å¤ä¸º1`, 'smoker', 'petri');
                        
                        // ç»§ç»­ä¸‹ä¸€è½®
                        if (this.isRunning) {
                            const delay = 1000 - (this.speed - 1) * 80;
                            this.timers.agent = setTimeout(() => this.fireTransitionT1(), delay);
                        }
                        this.updateDOM();
                    }, smokeTime);
                });
            },
            
            // è¾…åŠ©ï¼šè·å–èµ„æºåç§°
            getResourceName(resources) {
                return resources.map(r => {
                    return r === 'tobacco' ? 'çƒŸè‰' : r === 'paper' ? 'çº¸' : 'ç«æŸ´';
                }).join('+');
            },
            
            // æ›´æ–°DOM
            updateDOM() {
                // æ›´æ–°åº“æ‰€çŠ¶æ€
                document.getElementById('pt-P1').textContent = this.places.P1;
                document.getElementById('pt-P2').textContent = this.places.P2;
                document.getElementById('pt-P3').textContent = this.places.P3;
                document.getElementById('pt-P4').textContent = this.places.P4;
                
                // æ›´æ–°è®¡æ•°
                document.getElementById('pt-smokerACount').textContent = this.count.A;
                document.getElementById('pt-smokerBCount').textContent = this.count.B;
                document.getElementById('pt-smokerCCount').textContent = this.count.C;
                
                // æ›´æ–°ä»£ç†çŠ¶æ€
                if (this.isRunning) {
                    if (this.places.P4 === 1) {
                        document.getElementById('pt-agentState').textContent = 'ç­‰å¾…æŠ•æ”¾èµ„æº';
                        document.getElementById('pt-agentStatusBadge').className = 'px-2 py-1 bg-purple-100 text-petri rounded-full text-xs font-medium';
                        document.getElementById('pt-agentStatusBadge').textContent = 'å°±ç»ª';
                    } else {
                        document.getElementById('pt-agentState').textContent = 'æŠ•æ”¾èµ„æºåç­‰å¾…';
                        document.getElementById('pt-agentStatusBadge').className = 'px-2 py-1 bg-purple-100 text-petri rounded-full text-xs font-medium';
                        document.getElementById('pt-agentStatusBadge').textContent = 'è¿è¡Œä¸­';
                    }
                } else {
                    document.getElementById('pt-agentState').textContent = 'å·²æš‚åœ';
                    document.getElementById('pt-agentStatusBadge').className = 'px-2 py-1 bg-amber-100 text-amber-700 rounded-full text-xs font-medium';
                    document.getElementById('pt-agentStatusBadge').textContent = 'å·²æš‚åœ';
                }
            }
        };

        // -------------------------- é€‰é¡¹å¡åˆ‡æ¢é€»è¾‘ --------------------------
        function setupTabs() {
            const tabs = {
                deadlock: { tab: document.getElementById('tab-deadlock'), content: document.getElementById('scheme-deadlock') },
                parnas: { tab: document.getElementById('tab-parnas'), content: document.getElementById('scheme-parnas') },
                petri: { tab: document.getElementById('tab-petri'), content: document.getElementById('scheme-petri') }
            };
            
            // æ¸…é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€å¹¶æš‚åœå½“å‰æ–¹æ¡ˆ
            function clearActive() {
                // æš‚åœæ‰€æœ‰è¿è¡Œä¸­çš„æ–¹æ¡ˆ
                if (DL.isRunning) DL.pause();
                if (PN.isRunning) PN.pause();
                if (PT.isRunning) PT.pause();
                
                // æ¸…é™¤UIæ´»åŠ¨çŠ¶æ€
                Object.values(tabs).forEach(item => {
                    item.tab.classList.remove('tab-active', 'tab-deadlock-active', 'tab-petri-active');
                    item.content.classList.add('hidden');
                });
                
                // æ¸…é™¤æ‰€æœ‰èµ„æºåŠ¨ç”»
                const animations = document.querySelectorAll('.resource-item');
                animations.forEach(el => el.remove());
            }
            
            // ç»‘å®šé€‰é¡¹å¡äº‹ä»¶
            tabs.deadlock.tab.addEventListener('click', () => {
                clearActive();
                tabs.deadlock.tab.classList.add('tab-deadlock-active');
                tabs.deadlock.content.classList.remove('hidden');
                DL.updateDOM(); // ç¡®ä¿UIçŠ¶æ€æ­£ç¡®
            });
            
            tabs.parnas.tab.addEventListener('click', () => {
                clearActive();
                tabs.parnas.tab.classList.add('tab-active');
                tabs.parnas.content.classList.remove('hidden');
                PN.updateDOM(); // ç¡®ä¿UIçŠ¶æ€æ­£ç¡®
            });
            
            tabs.petri.tab.addEventListener('click', () => {
                clearActive();
                tabs.petri.tab.classList.add('tab-petri-active');
                tabs.petri.content.classList.remove('hidden');
                PT.updateDOM(); // ç¡®ä¿UIçŠ¶æ€æ­£ç¡®
            });
        }

        // -------------------------- åˆå§‹åŒ–æ‰€æœ‰æ–¹æ¡ˆ --------------------------
        window.addEventListener('DOMContentLoaded', () => {
            setupTabs();
            setupScrollHandler(); // åˆå§‹åŒ–æ»šåŠ¨å¤„ç†
            DL.init();
            PN.init();
            PT.init();
        });
    </script>
</body>
</html>
